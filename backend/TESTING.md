# åç«¯æœåŠ¡æµ‹è¯•æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•æµ‹è¯• AI æ—¥ç¨‹åŠ©æ‰‹åç«¯æœåŠ¡ã€‚

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

### 1. å®‰è£…ä¾èµ–

```bash
cd backend
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰ï¼š

```bash
# Windows
copy .env.example .env

# Linux/Mac
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ OpenAI API Keyï¼š

```env
OPENAI_API_KEY=sk-your-api-key-here
PORT=5000
NODE_ENV=development
LOG_LEVEL=info
```

**é‡è¦**: ç¡®ä¿ `OPENAI_API_KEY` å·²æ­£ç¡®é…ç½®ï¼Œå¦åˆ™æœåŠ¡æ— æ³•è°ƒç”¨ OpenAI APIã€‚

## ğŸš€ å¯åŠ¨æœåŠ¡

### æ–¹å¼1: ç”Ÿäº§æ¨¡å¼

```bash
npm start
```

### æ–¹å¼2: å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰

```bash
npm run dev
```

å¯åŠ¨æˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ°ï¼š

```
ğŸš€ Server is running on http://localhost:5000
ğŸ“ Environment: development
â° Started at: 2025-01-01T20:00:00.000Z
```

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1: ä½¿ç”¨æµ‹è¯•é¡µé¢ï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€ç›´è§‚çš„æµ‹è¯•æ–¹å¼ï¼Œå¯ä»¥å®æ—¶çœ‹åˆ°æ—¥å†æ¸²æŸ“æ•ˆæœã€‚

1. **å¯åŠ¨åç«¯æœåŠ¡**ï¼ˆç¡®ä¿åœ¨è¿è¡Œï¼‰

2. **æ‰“å¼€æµ‹è¯•é¡µé¢**
   - ç”¨æµè§ˆå™¨æ‰“å¼€ `test-page/index.html`
   - æˆ–è€…ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨ï¼š
     ```bash
     # ä½¿ç”¨ Python
     cd test-page
     python -m http.server 8000
     # ç„¶åè®¿é—® http://localhost:8000
     ```

3. **æµ‹è¯•åŠŸèƒ½**
   - åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥è‡ªç„¶è¯­è¨€ï¼Œä¾‹å¦‚ï¼š`æ˜å¤©ä¸‹åˆ3ç‚¹å’Œè€æ¿å¼€ä¼š`
   - ç‚¹å‡»"è§£æå¹¶æ·»åŠ åˆ°æ—¥å†"æŒ‰é’®
   - æŸ¥çœ‹æ—¥å†ä¸­æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºäº‹ä»¶

4. **æµ‹è¯•åœºæ™¯**
   - ç‚¹å‡»é¡µé¢ä¸‹æ–¹çš„æµ‹è¯•åœºæ™¯æŒ‰é’®ï¼Œå¿«é€Ÿå¡«å……ç¤ºä¾‹æ–‡æœ¬
   - æµ‹è¯•å¤šä¸ªåœºæ™¯ï¼šç®€å•äº‹ä»¶ã€å¤šä¸ªäº‹ä»¶ã€å…¨å¤©äº‹ä»¶ã€é‡å¤äº‹ä»¶

### æ–¹æ³•2: ä½¿ç”¨ API æµ‹è¯•è„šæœ¬

è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œé€‚åˆéªŒè¯æ‰€æœ‰åŠŸèƒ½ã€‚

1. **ç¡®ä¿æœåŠ¡æ­£åœ¨è¿è¡Œ**

2. **è¿è¡Œæµ‹è¯•è„šæœ¬**
   ```bash
   npm test
   ```

3. **æŸ¥çœ‹æµ‹è¯•ç»“æœ**
   ```
   ========================================
   API é›†æˆæµ‹è¯•
   ========================================

   æµ‹è¯•: å¥åº·æ£€æŸ¥
   âœ… é€šè¿‡

   æµ‹è¯•: ç®€å•äº‹ä»¶è§£æ
   âœ… é€šè¿‡
      è§£æå‡º 1 ä¸ªäº‹ä»¶

   æµ‹è¯•: å¤šä¸ªäº‹ä»¶è§£æ
   âœ… é€šè¿‡
      è§£æå‡º 3 ä¸ªäº‹ä»¶

   ...

   ========================================
   ç»“æœ: 6/6 é€šè¿‡
   é€šè¿‡ç‡: 100.0%
   ========================================
   ```

### æ–¹æ³•3: ä½¿ç”¨ curl å‘½ä»¤

é€‚åˆå¿«é€Ÿæµ‹è¯•å•ä¸ªæ¥å£ã€‚

#### æµ‹è¯•å¥åº·æ£€æŸ¥

```bash
curl http://localhost:5000/health
```

é¢„æœŸå“åº”ï¼š
```json
{
  "status": "ok",
  "timestamp": "2025-01-01T20:00:00.000Z",
  "service": "AI Schedule Assistant API",
  "version": "1.0.0"
}
```

#### æµ‹è¯•è§£ææ¥å£

```bash
curl -X POST http://localhost:5000/api/v1/events/parse \
  -H "Content-Type: application/json" \
  -d "{
    \"text\": \"æ˜å¤©ä¸‹åˆ3ç‚¹å’Œè€æ¿å¼€ä¼š\",
    \"context\": {
      \"current_time\": \"2025-01-01T20:00:00+08:00\",
      \"timezone\": \"Asia/Shanghai\",
      \"locale\": \"zh-CN\"
    }
  }"
```

**Windows PowerShell ç‰ˆæœ¬**ï¼š
```powershell
$body = @{
    text = "æ˜å¤©ä¸‹åˆ3ç‚¹å’Œè€æ¿å¼€ä¼š"
    context = @{
        current_time = "2025-01-01T20:00:00+08:00"
        timezone = "Asia/Shanghai"
        locale = "zh-CN"
    }
} | ConvertTo-Json -Depth 10

Invoke-RestMethod -Uri "http://localhost:5000/api/v1/events/parse" `
  -Method Post `
  -ContentType "application/json" `
  -Body $body
```

é¢„æœŸå“åº”ï¼š
```json
{
  "success": true,
  "timestamp": "2025-01-01T20:00:05+08:00",
  "request_id": "req_1704117600000_abc123",
  "events": [
    {
      "id": "evt_1704117600000_0",
      "title": "å’Œè€æ¿å¼€ä¼š",
      "start": "2025-01-02T15:00:00+08:00",
      "end": "2025-01-02T16:00:00+08:00",
      "allDay": false,
      "backgroundColor": "#3788d8",
      ...
    }
  ],
  "metadata": {
    "total_events": 1,
    "parsing_time_ms": 1250,
    "confidence_score": 0.95
  }
}
```

## ğŸ“ æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

### 1. ç®€å•äº‹ä»¶

```json
{
  "text": "æ˜å¤©ä¸‹åˆ3ç‚¹å’Œè€æ¿å¼€ä¼š",
  "context": {
    "current_time": "2025-01-01T20:00:00+08:00",
    "timezone": "Asia/Shanghai"
  }
}
```

### 2. å¤šä¸ªäº‹ä»¶

```json
{
  "text": "æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼šï¼Œ5ç‚¹å¥èº«ï¼Œæ™šä¸Š8ç‚¹åƒé¥­",
  "context": {
    "current_time": "2025-01-01T20:00:00+08:00",
    "timezone": "Asia/Shanghai"
  }
}
```

### 3. å…¨å¤©äº‹ä»¶

```json
{
  "text": "ä¸‹å‘¨ä¸€å…¨å¤©å›¢å»º",
  "context": {
    "current_time": "2025-01-01T20:00:00+08:00",
    "timezone": "Asia/Shanghai"
  }
}
```

### 4. é‡å¤äº‹ä»¶

```json
{
  "text": "æ¯å‘¨ä¸‰æ—©ä¸Š9ç‚¹ç«™ä¼š15åˆ†é’Ÿ",
  "context": {
    "current_time": "2025-01-01T20:00:00+08:00",
    "timezone": "Asia/Shanghai"
  }
}
```

### 5. é”™è¯¯æµ‹è¯• - ç©ºè¾“å…¥

```json
{
  "text": "",
  "context": {
    "current_time": "2025-01-01T20:00:00+08:00",
    "timezone": "Asia/Shanghai"
  }
}
```

é¢„æœŸï¼šè¿”å› `E1001` é”™è¯¯

### 6. é”™è¯¯æµ‹è¯• - ç¼ºå°‘ context

```json
{
  "text": "æ˜å¤©å¼€ä¼š"
}
```

é¢„æœŸï¼šè¿”å› `E1002` é”™è¯¯

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: æœåŠ¡æ— æ³•å¯åŠ¨

**é”™è¯¯**: `OPENAI_API_KEY is not set in environment variables`

**è§£å†³**: 
- æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- ç¡®è®¤ `OPENAI_API_KEY` å·²æ­£ç¡®é…ç½®
- ç¡®ä¿ `.env` æ–‡ä»¶åœ¨ `backend` ç›®å½•ä¸‹

### é—®é¢˜2: ç«¯å£è¢«å ç”¨

**é”™è¯¯**: `Error: listen EADDRINUSE: address already in use :::5000`

**è§£å†³**:
```bash
# ä¿®æ”¹ .env ä¸­çš„ PORT
PORT=5001

# æˆ–è€…å…³é—­å ç”¨ç«¯å£çš„è¿›ç¨‹
# Windows
netstat -ano | findstr :5000
taskkill /PID <è¿›ç¨‹ID> /F

# Linux/Mac
lsof -ti:5000 | xargs kill
```

### é—®é¢˜3: API è°ƒç”¨å¤±è´¥

**é”™è¯¯**: `AI è§£ææœåŠ¡æš‚æ—¶ä¸å¯ç”¨`

**å¯èƒ½åŸå› **:
1. OpenAI API Key æ— æ•ˆæˆ–è¿‡æœŸ
2. API ä½™é¢ä¸è¶³
3. ç½‘ç»œè¿æ¥é—®é¢˜
4. OpenAI æœåŠ¡æš‚æ—¶ä¸å¯ç”¨

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
3. æµ‹è¯• OpenAI API Key æ˜¯å¦æœ‰æ•ˆï¼š
   ```bash
   curl https://api.openai.com/v1/models \
     -H "Authorization: Bearer YOUR_API_KEY"
   ```

### é—®é¢˜4: æµ‹è¯•é¡µé¢æ— æ³•è¿æ¥åç«¯

**é”™è¯¯**: `Failed to fetch` æˆ– `CORS error`

**è§£å†³**:
1. ç¡®è®¤åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥ API åœ°å€æ˜¯å¦æ­£ç¡®ï¼ˆé»˜è®¤ `http://localhost:5000`ï¼‰
3. å¦‚æœä½¿ç”¨ä¸åŒçš„ç«¯å£ï¼Œä¿®æ”¹ `test-page/index.html` ä¸­çš„ `API_BASE_URL`

### é—®é¢˜5: è§£æç»“æœä¸æ­£ç¡®

**æ’æŸ¥**:
1. æ£€æŸ¥ `current_time` æ˜¯å¦æ­£ç¡®ï¼ˆåº”è¯¥æ˜¯å½“å‰æ—¶é—´ï¼‰
2. æ£€æŸ¥ `timezone` æ˜¯å¦åŒ¹é…ä½ çš„æ—¶åŒº
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—äº†è§£è¯¦ç»†è§£æè¿‡ç¨‹
4. å°è¯•æ›´æ˜ç¡®çš„è¾“å…¥ï¼Œä¾‹å¦‚ï¼š"æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼š" è€Œä¸æ˜¯ "æ˜å¤©å¼€ä¼š"

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### æµ‹è¯•å“åº”æ—¶é—´

```bash
# ä½¿ç”¨ curl æµ‹è¯•å“åº”æ—¶é—´
curl -w "\næ—¶é—´: %{time_total}ç§’\n" \
  -X POST http://localhost:5000/api/v1/events/parse \
  -H "Content-Type: application/json" \
  -d '{"text":"æ˜å¤©å¼€ä¼š","context":{"current_time":"2025-01-01T20:00:00+08:00","timezone":"Asia/Shanghai"}}'
```

### å‹åŠ›æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

ä½¿ç”¨å·¥å…·å¦‚ `ab` æˆ– `wrk` è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼š

```bash
# å®‰è£… ab (Apache Bench)
# ç„¶åè¿è¡Œ
ab -n 10 -c 2 -p request.json -T application/json \
  http://localhost:5000/api/v1/events/parse
```

## âœ… éªŒæ”¶æ¸…å•

æµ‹è¯•å®Œæˆåï¼Œç¡®è®¤ä»¥ä¸‹åŠŸèƒ½æ­£å¸¸ï¼š

- [ ] æœåŠ¡èƒ½æ­£å¸¸å¯åŠ¨
- [ ] å¥åº·æ£€æŸ¥æ¥å£è¿”å› 200
- [ ] ç®€å•äº‹ä»¶è§£ææˆåŠŸ
- [ ] å¤šä¸ªäº‹ä»¶è§£ææˆåŠŸ
- [ ] å…¨å¤©äº‹ä»¶è§£ææˆåŠŸ
- [ ] é‡å¤äº‹ä»¶è§£ææˆåŠŸ
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®ï¼ˆç©ºè¾“å…¥ã€ç¼ºå°‘å‚æ•°ç­‰ï¼‰
- [ ] æµ‹è¯•é¡µé¢èƒ½æ­£å¸¸æ˜¾ç¤ºæ—¥å†
- [ ] æ—¶åŒºå¤„ç†æ­£ç¡®ï¼ˆæ—¶é—´åŒ…å«æ—¶åŒºä¿¡æ¯ï¼‰
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸

## ğŸ¯ ä¸‹ä¸€æ­¥

æµ‹è¯•é€šè¿‡åï¼Œä½ å¯ä»¥ï¼š

1. æŸ¥çœ‹æ—¥å¿—äº†è§£è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹
2. è°ƒæ•´ System Prompt ä¼˜åŒ–è§£æå‡†ç¡®æ€§
3. æ·»åŠ æ›´å¤šæµ‹è¯•ç”¨ä¾‹
4. å‡†å¤‡éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [API æ–‡æ¡£](README.md)
- [é¡¹ç›®è¯´æ˜](../../README.md)

